<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.above.dao.ClassInfoMapper">
    <sql id="myBaseSql">
        cla.id,cla.school_id schoolId,cla.department_id departmentId,cla.class_name className,
        di.department_name departmentName, si.school_name schoolName
    </sql>

    <select id="getClassListWithOther" resultType="com.above.dto.ClassListWithOther">
        SELECT
        sc.id AS schoolId,
        sc.school_name AS schoolName,
        d.id AS departmentId,
        d.department_name AS departmentName,
        c.id AS classId,
        c.class_name AS className
        FROM
        class_info AS c
        LEFT JOIN school_info AS sc ON c.school_id = sc.id
        LEFT JOIN department_info AS d ON c.department_id = d.id
        WHERE
        c.deleted =0
        <if test="schoolId != null">
            AND c.school_id= #{schoolId}
        </if>
        <if test="departmentId != null">
            AND c.department_id= #{departmentId}
        </if>
        <if test="classId != null">
            AND c.id= #{classId}
        </if>
        <if test="schoolIds != null and schoolIds.size()>0">
            AND c.school_id IN
            <foreach collection="schoolIds" index="index" item="id" open="(" separator="," close=")">
                #{id}
            </foreach>
        </if>
        <if test="departmentIds != null and departmentIds.size()>0">
            AND c.department_id IN
            <foreach collection="departmentIds" index="index" item="id" open="(" separator="," close=")">
                #{id}
            </foreach>
        </if>
        <if test="classIds != null and classIds.size()>0">
            AND c.id IN
            <foreach collection="classIds" index="index" item="id" open="(" separator="," close=")">
                #{id}
            </foreach>
        </if>
        <if test="key != null">
            AND c.class_name like  CONCAT('%',#{key},'%')
        </if>
        ORDER BY c.school_id ASC,c.department_id ASC,c.id ASC
        limit #{start},#{size}
    </select>
    <select id="getClassInfoDtoList" resultType="com.above.bean.theory.ClassInfoDto">
        SELECT
        <include refid="myBaseSql"/>
        FROM `class_info` cla
        LEFT JOIN department_info di ON di.id = cla.department_id AND cla.deleted = 0
        LEFT JOIN school_info si ON si.id = cla.school_id AND cla.deleted = 0
        WHERE cla.deleted = 0
    </select>
    <select id="getCount" resultType="java.lang.Integer">
        SELECT
        COUNT(1)
        FROM
        class_info AS c
        LEFT JOIN school_info AS sc ON c.school_id = sc.id
        LEFT JOIN department_info AS d ON c.department_id = d.id
        WHERE
        c.deleted =0
        <if test="schoolId != null">
            AND c.school_id= #{schoolId}
        </if>
        <if test="departmentId != null">
            AND c.department_id= #{departmentId}
        </if>
        <if test="classId != null">
            AND c.id= #{classId}
        </if>
        <if test="schoolIds != null and schoolIds.size()>0">
            AND c.school_id IN
            <foreach collection="schoolIds" index="index" item="id" open="(" separator="," close=")">
                #{id}
            </foreach>
        </if>
        <if test="departmentIds != null and departmentIds.size()>0">
            AND c.department_id IN
            <foreach collection="departmentIds" index="index" item="id" open="(" separator="," close=")">
                #{id}
            </foreach>
        </if>
        <if test="classIds != null and classIds.size()>0">
            AND c.id IN
            <foreach collection="classIds" index="index" item="id" open="(" separator="," close=")">
                #{id}
            </foreach>
        </if>
        <if test="key != null">
            AND c.class_name like  CONCAT('%',#{key},'%')
        </if>
    </select>
</mapper>
