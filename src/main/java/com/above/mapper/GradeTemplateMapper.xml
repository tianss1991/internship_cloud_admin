<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.above.dao.GradeTemplateMapper">

    <sql id="gradeInfo">
        id,pid,plan_id,content,score,create_by,create_datetime,update_by,update_datetime
    </sql>

    <resultMap id="GradePidMap" type="com.above.dto.GradeTemplateDto" >
        <id column="id" property="id" jdbcType="INTEGER" />
        <result column="pid" property="pid" jdbcType="INTEGER" />
        <result column="plan_id" property="planId" jdbcType="INTEGER" />
        <result column="content" property="content" jdbcType="VARCHAR" />
        <result column="score" property="score" jdbcType="VARCHAR" />
        <result column="create_by" property="createBy" jdbcType="INTEGER" />
        <result column="create_datetime" property="createDatetime" jdbcType="DATE" />
        <result column="update_by" property="updateBy" jdbcType="INTEGER" />
        <result column="update_datetime" property="updateDatetime" jdbcType="DATE" />
        <collection property="children" column="id" javaType="ArrayList"
                    ofType="com.above.dto.GradeTemplateDto" select="getGradeChildrenById"/>
    </resultMap>

    <resultMap id="GradeChildrenMap" type="com.above.dto.GradeTemplateDto">
        <id column="id" property="id" jdbcType="INTEGER" />
        <result column="pid" property="pid" jdbcType="INTEGER" />
        <result column="plan_id" property="planId" jdbcType="INTEGER" />
        <result column="content" property="content" jdbcType="VARCHAR" />
        <result column="score" property="score" jdbcType="VARCHAR" />
        <result column="create_by" property="createBy" jdbcType="INTEGER" />
        <result column="create_datetime" property="createDatetime" jdbcType="DATE" />
        <result column="update_by" property="updateBy" jdbcType="INTEGER" />
        <result column="update_datetime" property="updateDatetime" jdbcType="DATE" />
        <collection property="children" column="id" javaType="ArrayList"
                    ofType="com.above.dto.GradeTemplateDto" select="getGradeChildrenById"/>
    </resultMap>

    <select id="getGradePidById" resultMap="GradePidMap" parameterType="com.above.vo.BaseVo" >
        select
            <include refid="gradeInfo"/>
        from
            grade_template
        where
            plan_id = #{planId}
            and pid is null
    </select>

    <select id="getGradeChildrenById" resultMap="GradeChildrenMap" parameterType="java.lang.Integer" >
        select
            <include refid="gradeInfo"/>
        from
             grade_template
        where
              pid = #{id}
    </select>


</mapper>
